# Документация по тестированию

## Стек тестирования

Для обеспечения качества и надежности кода используется следующий набор инструментов:

- **[Vitest](https://vitest.dev/):** Современный и быстрый фреймворк для тестирования, совместимый с Vite.
- **[React Testing Library](https://testing-library.com/docs/react-testing-library/intro/):** Библиотека для тестирования React-компонентов, ориентированная на взаимодействие с пользователем.
- **[jest-dom](https://github.com/testing-library/jest-dom):** Добавляет кастомные матчеры для Jest/Vitest для упрощения работы с DOM.
- **[user-event](https://testing-library.com/docs/user-event/intro):** Симулирует реальные события пользователя (клики, ввод текста) для более надежных тестов.
- **[Axe-core](https://github.com/dequelabs/axe-core):** Движок для автоматического тестирования доступности (accessibility).
- **[Playwright](https://playwright.dev/):** Инструмент для E2E тестирования с поддержкой множества браузеров.

## Настройка

- **`vitest.config.ts`:** Основной файл конфигурации для Vitest. Он настраивает тестовую среду (jsdom), глобальные переменные и пути.
- **`src/test/setup.ts`:** Файл для глобальной настройки тестов. Здесь импортируются матчеры `jest-dom` и настраиваются моки для глобальных API, таких как `matchMedia` и `IntersectionObserver`, чтобы компоненты, использующие их, корректно работали в тестовой среде.
- **`src/test/test-utils.tsx`:** Утилиты для тестирования с провайдерами, оборачивающие тестируемые компоненты в `BrowserRouter`, `ThemeProvider` и `I18nextProvider` для упрощения тестирования.

## Типы тестов

### Unit-тесты и Интеграционные тесты

- **Что тестируется:** Отдельные компоненты (`Button`, `Card`) и их интеграция в более крупные секции (`Header`, `ContactSection`).
- **Цель:** Проверить, что компоненты корректно рендерятся, отображают переданные данные и правильно реагируют на действия пользователя (клики, ввод данных).
- **Примеры:**
  - Тест для `Header` проверяет, что все навигационные ссылки отображаются.
  - Тест для `ContactSection` симулирует заполнение и отправку формы, проверяя появление сообщений об ошибках и успехе.

### Тесты на доступность (Accessibility, a11y)

- **Что тестируется:** Соответствие компонентов стандартам WCAG.
- **Файл:** `src/test/accessibility.test.tsx`.
- **Инструмент:** `axe-core`.
- **Цель:** Убедиться, что в компонентах нет нарушений доступности (например, отсутствующие `aria-label`, недостаточный контраст, некорректная структура). Тесты автоматически проверяют DOM-дерево отрендеренного компонента и выбрасывают ошибку при наличии нарушений.

### E2E тесты

- **Что тестируется:** Критические пользовательские сценарии.
- **Инструмент:** Playwright.
- **Цель:** Проверить, что вся система работает правильно в реальных условиях.

## Структура тестов

```
src/test/
├── setup.ts         # Общая настройка тестов
├── test-utils.tsx   # Утилиты для тестирования
└── accessibility.test.tsx  # Тесты доступности

src/components/**/*.test.tsx  # Тесты для компонентов
```

## Запуск тестов

В `package.json` определены следующие скрипты для запуска тестов:

- **Запуск всех тестов в watch-режиме:**

  ```bash
  npm run test
  ```

- **Запуск тестов с UI (удобный графический интерфейс для просмотра результатов):**

  ```bash
  npm run test:ui
  ```

- **Запуск тестов с генерацией отчета о покрытии:**

  ```bash
  npm run test:coverage
  ```

  Отчет будет сгенерирован в папке `coverage/`.

- **E2E тесты:**
  ```bash
  npm run test:e2e
  ```

## Покрытие кода

Цель: 30%+ покрытие кода. Покрытие отслеживается через Codecov.

## Best Practices

- Пишите тесты, которые проверяют пользовательские сценарии, а не реализацию
- Используйте `user-event` вместо `fireEvent` для более реалистичных тестов
- Проверяйте, что элементы отображаются и исчезают должным образом
- Проверяйте состояние компонентов при разных входных данных
- Тестируйте граничные случаи и ошибки
- Используйте screen.getBy*, screen.queryBy*, screen.findBy\* подходящим образом

## CI/CD интеграция

Тесты запускаются автоматически при каждом пуше и PR в GitHub Actions. Также проверяется покрытие кода и результаты публикуются на Codecov.
